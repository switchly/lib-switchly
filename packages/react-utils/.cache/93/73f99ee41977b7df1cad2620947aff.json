{"id":"../../node_modules/@mattkrick/event-source-polyfill/dist/index.js","dependencies":[{"name":"/Users/martinegan/development/internal/cornerstone-digital/lib-switchly/packages/react-utils/node_modules/@mattkrick/event-source-polyfill/dist/index.js.map","includedInParent":true,"mtime":1572591664136},{"name":"/Users/martinegan/development/internal/cornerstone-digital/lib-switchly/packages/react-utils/package.json","includedInParent":true,"mtime":1573131070679},{"name":"/Users/martinegan/development/internal/cornerstone-digital/lib-switchly/packages/react-utils/node_modules/@mattkrick/event-source-polyfill/package.json","includedInParent":true,"mtime":1572591664136}],"generated":{"js":"module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/EventSourcePolyfill.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/EventSourcePolyfill.ts\":\n/*!************************************!*\\\n  !*** ./src/EventSourcePolyfill.ts ***!\n  \\************************************/\n/*! exports provided: default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\nvar Fields;\n(function (Fields) {\n    Fields[\"EVENT\"] = \"event\";\n    Fields[\"DATA\"] = \"data\";\n    Fields[\"ID\"] = \"id\";\n    Fields[\"RETRY\"] = \"retry\";\n})(Fields || (Fields = {}));\nconst decodeUTF8 = (str) => decodeURIComponent(escape(str));\nconst normalizeToLF = (str) => str.replace(/\\r\\n|\\r/g, '\\n');\nclass EventSourcePolyfill extends EventTarget {\n    constructor(url, config) {\n        super();\n        this.CONNECTING = 0;\n        this.OPEN = 1;\n        this.CLOSED = 2;\n        this.lastEventId = '';\n        this.reconnectionTime = 2000;\n        this.responseTextCursor = 0;\n        this.eventTypeBuffer = '';\n        this.idBuffer = '';\n        this.dataBuffer = '';\n        this.canReconnect = true;\n        this.url = url;\n        this.withCredentials = Boolean(config && config.withCredentials);\n        this.addEventListener('error', (e) => {\n            if (this.onerror)\n                this.onerror(e);\n        });\n        this.addEventListener('message', (e) => {\n            if (this.onmessage)\n                this.onmessage(e);\n        });\n        this.addEventListener('open', (e) => {\n            if (this.onopen)\n                this.onopen(e);\n        });\n        this.connect();\n    }\n    announceConnection() {\n        this.readyState = this.OPEN;\n        this.dispatchEvent(new Event('open'));\n        this.responseTextCursor = 0;\n    }\n    connect(url = this.url) {\n        this.readyState = this.CONNECTING;\n        const xhr = this.xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.withCredentials = this.withCredentials;\n        xhr.setRequestHeader('Accept', 'text/event-stream');\n        xhr.setRequestHeader('Cache-Control', 'no-cache');\n        if (this.lastEventId) {\n            xhr.setRequestHeader('Last-Event-ID', this.lastEventId);\n        }\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState <= 1 || this.readyState === this.CLOSED)\n                return;\n            if (xhr.readyState === 4) {\n                this.reestablishConnection();\n                return;\n            }\n            switch (xhr.status) {\n                case 200:\n                    this.handleConnection(xhr);\n                    this.interpretStream(xhr);\n                    break;\n                case 204:\n                    this.canReconnect = false;\n                    break;\n                case 301:\n                case 307:\n                    const redirectUrl = xhr.getResponseHeader('Location');\n                    this.failConnection(xhr, true);\n                    if (redirectUrl) {\n                        this.connect(redirectUrl);\n                    }\n                    break;\n                default:\n                    this.failConnection(xhr);\n            }\n        };\n        xhr.send();\n    }\n    dispatchMessageEvent(origin) {\n        this.lastEventId = this.idBuffer;\n        if (this.dataBuffer === '') {\n            this.eventTypeBuffer = '';\n            return;\n        }\n        if (this.dataBuffer[this.dataBuffer.length - 1] === '\\n') {\n            this.dataBuffer = this.dataBuffer.slice(0, -1);\n        }\n        const eventType = this.eventTypeBuffer || 'message';\n        const event = new MessageEvent(eventType, { data: this.dataBuffer, origin, lastEventId: this.lastEventId });\n        this.eventTypeBuffer = '';\n        this.dataBuffer = '';\n        this.dispatchEvent(event);\n    }\n    handleConnection(xhr) {\n        if (this.readyState === this.CONNECTING) {\n            const contentType = xhr.getResponseHeader('Content-Type');\n            if (contentType && contentType.toLowerCase() === 'text/event-stream') {\n                this.announceConnection();\n            }\n            else {\n                this.failConnection(xhr);\n            }\n        }\n    }\n    failConnection(xhr, isSilent = false) {\n        this.readyState = this.CLOSED;\n        if (!isSilent) {\n            this.dispatchEvent(new Event('error'));\n        }\n        this.canReconnect = false;\n        xhr.abort();\n    }\n    interpretStream(xhr) {\n        if (this.readyState !== this.OPEN)\n            return;\n        let responseText = '';\n        try {\n            responseText = xhr.responseText;\n        }\n        catch (_a) {\n            return;\n        }\n        const rawChunk = responseText.substring(this.responseTextCursor);\n        this.responseTextCursor = responseText.length;\n        const chunk = normalizeToLF(decodeUTF8(rawChunk));\n        const lines = chunk.split('\\n');\n        for (let ii = 0; ii < lines.length; ii++) {\n            const line = lines[ii];\n            if (line === '') {\n                this.dispatchMessageEvent(xhr.responseURL);\n            }\n            else {\n                const firstColonIdx = line.indexOf(':');\n                if (firstColonIdx === 0) {\n                }\n                else if (firstColonIdx !== -1) {\n                    const field = line.substring(0, firstColonIdx);\n                    const untrimmedVal = line.substring(firstColonIdx + 1);\n                    const value = untrimmedVal.indexOf(' ') === 0 ? untrimmedVal.slice(1) : untrimmedVal;\n                    this.processField({ field, value });\n                }\n                else {\n                    this.processField({ field: line, value: '' });\n                }\n            }\n        }\n    }\n    processField(payload) {\n        switch (payload.field) {\n            case Fields.EVENT:\n                this.eventTypeBuffer = payload.value;\n                break;\n            case Fields.DATA:\n                this.dataBuffer += `${payload.value}\\n`;\n                break;\n            case Fields.ID:\n                if (payload.value.indexOf('\\u0000') === -1) {\n                    this.idBuffer = payload.value;\n                }\n                break;\n            case Fields.RETRY:\n                const interval = +payload.value;\n                if (Number.isInteger(interval)) {\n                    this.reconnectionTime = interval;\n                }\n        }\n    }\n    reestablishConnection() {\n        if (this.readyState === this.CLOSED || !this.canReconnect)\n            return;\n        this.readyState = this.CONNECTING;\n        this.dispatchEvent(new Event('error'));\n        setTimeout(() => {\n            if (this.readyState !== this.CONNECTING)\n                return;\n            this.connect();\n        }, this.reconnectionTime);\n    }\n    close() {\n        this.readyState = this.CLOSED;\n        this.xhr && this.xhr.abort();\n    }\n}\n/* harmony default export */ __webpack_exports__[\"default\"] = (EventSourcePolyfill);\n\n\n/***/ })\n\n/******/ });\n"},"sourceMaps":{"js":{"version":3,"sources":["webpack://EventSourcePolyfill/webpack/bootstrap","webpack://EventSourcePolyfill/./src/EventSourcePolyfill.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/EventSourcePolyfill.ts\");\n","enum Fields {\n  EVENT = 'event',\n  DATA = 'data',\n  ID = 'id',\n  RETRY = 'retry'\n}\n\ninterface MessagePayload {\n  field: Fields,\n  value: string\n}\n\n// removes leading BOM, etc\nconst decodeUTF8 = (str: string) => decodeURIComponent(escape(str))\nconst normalizeToLF = (str: string) => str.replace(/\\r\\n|\\r/g, '\\n')\n\nclass EventSourcePolyfill extends EventTarget implements EventSource {\n  readonly CONNECTING: 0 = 0\n  readonly OPEN: 1 = 1\n  readonly CLOSED: 2 = 2\n  readonly url: string\n  readonly withCredentials: boolean\n  private lastEventId: string = ''\n  private reconnectionTime: number = 2000\n  private responseTextCursor: number = 0\n  private eventTypeBuffer: string = ''\n  private idBuffer: string = ''\n  private dataBuffer: string = ''\n  private canReconnect: boolean = true\n  // casted to ! because lib.dom is wrong\n  onerror!: (evt: Event) => any\n  onmessage!: (evt: MessageEvent) => any\n  onopen!: (evt: Event) => any\n  readyState!: number\n  xhr: XMLHttpRequest | undefined\n\n  constructor (url: string, config?: EventSourceInit) {\n    super()\n    this.url = url\n    this.withCredentials = Boolean(config && config.withCredentials)\n    this.addEventListener('error', (e: Event) => {\n      if (this.onerror) this.onerror(e)\n    })\n    this.addEventListener('message', (e: Event) => {\n      // listener set as Event & later casted because lib.dom is wrong\n      if (this.onmessage) this.onmessage(e as MessageEvent)\n    })\n    this.addEventListener('open', (e: Event) => {\n      if (this.onopen) this.onopen(e)\n    })\n    this.connect()\n  }\n\n  private announceConnection () {\n    this.readyState = this.OPEN\n    this.dispatchEvent(new Event('open'))\n    this.responseTextCursor = 0\n  }\n\n  private connect (url: string = this.url) {\n    this.readyState = this.CONNECTING\n    const xhr = this.xhr = new XMLHttpRequest()\n    xhr.open('GET', url, true)\n    xhr.withCredentials = this.withCredentials\n    xhr.setRequestHeader('Accept', 'text/event-stream')\n    xhr.setRequestHeader('Cache-Control', 'no-cache')\n    if (this.lastEventId) {\n      xhr.setRequestHeader('Last-Event-ID', this.lastEventId)\n    }\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState <= 1 || this.readyState === this.CLOSED) return\n      if (xhr.readyState === 4) {\n        // is done\n        this.reestablishConnection()\n        return\n      }\n      switch (xhr.status) {\n        case 200:\n          this.handleConnection(xhr)\n          this.interpretStream(xhr)\n          break\n        case 204:\n          this.canReconnect = false\n          break\n        case 301:\n        case 307:\n          const redirectUrl = xhr.getResponseHeader('Location')\n          this.failConnection(xhr, true)\n          if (redirectUrl) {\n            this.connect(redirectUrl)\n          }\n          break\n        default:\n          this.failConnection(xhr)\n      }\n    }\n    xhr.send()\n  }\n\n  private dispatchMessageEvent (origin?: string) {\n    this.lastEventId = this.idBuffer\n    if (this.dataBuffer === '') {\n      this.eventTypeBuffer = ''\n      return\n    }\n    if (this.dataBuffer[this.dataBuffer.length - 1] === '\\n') {\n      this.dataBuffer = this.dataBuffer.slice(0, -1)\n    }\n    const eventType = this.eventTypeBuffer || 'message'\n    const event = new MessageEvent(eventType, {data: this.dataBuffer, origin, lastEventId: this.lastEventId})\n    this.eventTypeBuffer = ''\n    this.dataBuffer = ''\n    this.dispatchEvent(event)\n  }\n\n  private handleConnection (xhr: XMLHttpRequest) {\n    if (this.readyState === this.CONNECTING) {\n      const contentType = xhr.getResponseHeader('Content-Type')\n      if (contentType && contentType.toLowerCase() === 'text/event-stream') {\n        this.announceConnection()\n      } else {\n        this.failConnection(xhr)\n      }\n    }\n  }\n\n  private failConnection (xhr: XMLHttpRequest, isSilent: boolean = false) {\n    this.readyState = this.CLOSED\n    if (!isSilent) {\n      this.dispatchEvent(new Event('error'))\n    }\n    this.canReconnect = false\n    xhr.abort()\n  }\n\n  private interpretStream (xhr: XMLHttpRequest) {\n    if (this.readyState !== this.OPEN) return\n\n    let responseText = ''\n    try {\n      responseText = xhr.responseText\n    } catch {\n      return\n    }\n\n    const rawChunk = responseText.substring(this.responseTextCursor)\n    this.responseTextCursor = responseText.length\n\n    const chunk = normalizeToLF(decodeUTF8(rawChunk))\n\n    const lines = chunk.split('\\n')\n    for (let ii = 0; ii < lines.length; ii++) {\n      const line = lines[ii]\n      if (line === '') {\n        this.dispatchMessageEvent(xhr.responseURL)\n      } else {\n        const firstColonIdx = line.indexOf(':')\n        if (firstColonIdx === 0) {\n          // ignore comment line\n        } else if (firstColonIdx !== -1) {\n          const field = line.substring(0, firstColonIdx) as Fields\n          const untrimmedVal = line.substring(firstColonIdx + 1)\n          const value = untrimmedVal.indexOf(' ') === 0 ? untrimmedVal.slice(1) : untrimmedVal\n          this.processField({field, value})\n        } else {\n          this.processField({field: line as Fields, value: ''})\n        }\n      }\n    }\n\n  }\n\n  private processField (payload: MessagePayload) {\n    switch (payload.field) {\n      case Fields.EVENT:\n        this.eventTypeBuffer = payload.value\n        break\n      case Fields.DATA:\n        this.dataBuffer += `${payload.value}\\n`\n        break\n      case Fields.ID:\n        if (payload.value.indexOf('\\u0000') === -1) {\n          this.idBuffer = payload.value\n        }\n        break\n      case Fields.RETRY:\n        const interval = +payload.value\n        if (Number.isInteger(interval)) {\n          this.reconnectionTime = interval\n        }\n    }\n  }\n\n  private reestablishConnection () {\n    if (this.readyState === this.CLOSED || !this.canReconnect) return\n    this.readyState = this.CONNECTING\n    this.dispatchEvent(new Event('error'))\n    setTimeout(() => {\n      if (this.readyState !== this.CONNECTING) return\n      this.connect()\n    }, this.reconnectionTime)\n  }\n\n  close () {\n    this.readyState = this.CLOSED\n    this.xhr && this.xhr.abort()\n  }\n}\n\nexport default EventSourcePolyfill\n"],"sourceRoot":""}},"error":null,"hash":"04922f7b32dda1d6bb43caaac17aaebf","cacheData":{"env":{}}}